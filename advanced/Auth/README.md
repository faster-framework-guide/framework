# 权限认证

在接口开发过程中，我们往往需要指定某个接口需要认证授权才可以访问，为此我们提供了Auth模块来实现系统的认证与授权，Auth模块使用Jwt生成授权凭据。

接下来我们将为您介绍一些基本的概念。

认证（authentication ）与授权（authorization ）往往是容易混淆的两个概念，当我们的系统涉及到登录、权限控制时，这两个概念通常会相互结合使用。一般来说认证与授权会作为系统基础架构的关键部分。

### 认证
认证是通过某种凭据来验证身份是否正确，如用户名和密码。

### 授权
授权是在系统成功验证身份后发生的，服务端会将认证通过的用户颁发一个访问系统的凭据，用户访问系统时携带其凭据，服务端通过它来确定已经通过认证的用户可以访问哪些资源，即权限控制。

比如我们后台管理在登录成功后根据角色不同，展示不同的菜单。移动端根据角色不同使用不同的终端（教师端、 学生端）。PC端登录不同的账号展示不同的功能。需要注意的是，页面展示与接口请求通常是共同完成权限控制的。

### RBAC

谈到认证授权，我们就不得不提起RBAC（Role-Based Access Control）模型，它是一种基于角色的访问控制。包含三个概念，用户、角色、权限，用户通过成为适当的角色成员而得到某些权限。

RBAC往往通过建立数据表来动态控制用户、角色、权限三者之间的关系。

一般模型如下：

![](../../_media/auth1.png)

基本流程如下：

![](../../_media/auth2.png)

流程中的每一步都可以进行扩展，比如：
1. 登录的认证可以扩展为三方登录。
2. 服务端返回凭证的同时，可以返回该凭证的权限列表，实现前端动态生成菜单的功能。
3. 前端请求接口携带的凭证，可以存储在session、cookie、或header中。客户端可以主动传输或被动传输。
4. 服务端通过凭证进行权限检验时，可以将权限列表放入缓存中，


### JWT
在RBAC中生成的凭据，既可以有状态的存储在服务端，也可以无状态的加密后返还给客户端。

JWT是一种无状态的加密凭据，它的设计紧凑并且安全。

JWT的全称是Json web token。它一般被用来在客户端和服务端之间传递认证信息。简单来说，它就是一个token。但是它可以被加密和解密。

JWT是由三段信息构成的。


第一部分我们称它为头部（header),第二部分我们称其为有效载荷（payload)，即货物，要传输的业务信息，第三部分是签证（signature).


在业务场景中，我们只需要关心Payload部分即可。一般情况我们会将Payload中放入与系统用户相关的信息，如：

```
{
	"id":"用户id",
	"roleId":"角色id"
}
```

将这三段信息文本用“.”链接一起就构成了Jwt字符串：

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
```