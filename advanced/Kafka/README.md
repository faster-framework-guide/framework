# Kafka

## Kafka基本介绍
Kafka是一个分布式流平台，它包含三个主要功能：
1. 发布和订阅消息。
2. 以容错的方式存储消息。
3. 可以处理流。

消息中间件的概念：消息中间件是指利用高效可靠的消息传递机制进行与平台无关的数据交流，并基于数据通信来进行分布式系统的集成。

理解：消息中间件是用来解决系统之间传输大量数据时阻塞的问题。消息中间件提供了系统之间传输的媒介，用于持久化消息及对消息分发的负载。


基本组成：

1. producer：生产者，生产消息。
2. consumer：消费者，消费消息。
3. topic：类别/主题，生产消息时的分类，消费者消费对应类型的消息。相当于生产者将消息放入队列中，消费者从指定队列获取消息。消费者可以订阅多个主题。
4. broker：中间商/代理。生产者生产的消息保存在这里。相当于存储媒介。消费者从broker拉取消息。

## Group（分组）和Partition（分区）
首先要明确的一点，分组与分区是针对于读取消息的消费者而言的，与生产者无关。由于kafka消息的特殊性，其日志存储在硬盘中，故消费端可以重复消费。

所以消费端引入了消费者组的概念来实现消息模型的队列和发布订阅模式，即消费端指定相同分组后，某个消息针对该分组只会被分发给该组中的消费者一次。

而分区是用于并行消费的主要手段，每个topic在创建时，会生成N个分区（可配置），分区会存在于不同的节点服务器上。相同分组下的消费者，可以同时消费消息，即同时从不同的分区中拉取消息。相同分区下的消费是顺序执行的。

在真实的物理磁盘存储中，分区的表现形式如下：

```
testTopic-0		testTopic-1		testTopic-2		testTopic-3
```

在分区的下级目录，存储着真实的消息：

```
00000000000000000000.index		00000000000000000000.log		00000000000000000000.timeindex
```

ps: 每条消息是由key、value、timestamp组成


最终我们会得出以下结论，对于一条消息而言：

1. 同一分组下的不同分区只会被消费一次，顺序无法保证，但可以并行消费。
2. 同一分组下的同一分区会被消费一次，并且可以保证顺序执行。
3. 不同分组下的消息会被重复消费。
